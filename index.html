<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destructive Interference Demo</title>
</head>
<body>
    <h1>Phase Cancellation Test</h1>
    <p>Click Start to attempt noise cancellation using phase inversion.</p>
    <button id="startButton">Start</button>
    <button id="stopButton" disabled>Stop</button>
    <p id="status">Status: Idle</p>

    <script>
        let audioContext;
        let micStream;
        let sourceNode, invertedGainNode;

        async function startPhaseCancellation() {
            try {
                document.getElementById('status').innerText = "Requesting microphone access...";
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });

                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(micStream);

                // Create a gain node with inverted phase (-1 gain)
                invertedGainNode = audioContext.createGain();
                invertedGainNode.gain.value = -1; // Invert the phase

                // Connect the nodes: Mic -> Inverted Gain -> Output
                source.connect(invertedGainNode);
                invertedGainNode.connect(audioContext.destination);

                document.getElementById('status').innerText = "Status: Attempting Phase Cancellation";
                document.getElementById('startButton').disabled = true;
                document.getElementById('stopButton').disabled = false;
            } catch (error) {
                console.error("Error accessing microphone:", error);
                document.getElementById('status').innerText = "Error: Unable to access microphone.";
            }
        }

        function stopPhaseCancellation() {
            if (micStream) micStream.getTracks().forEach(track => track.stop());
            if (audioContext) audioContext.close();

            document.getElementById('status').innerText = "Status: Stopped";
            document.getElementById('startButton').disabled = false;
            document.getElementById('stopButton').disabled = true;
        }

        document.getElementById('startButton').addEventListener('click', startPhaseCancellation);
        document.getElementById('stopButton').addEventListener('click', stopPhaseCancellation);
    </script>
</body>
</html>
