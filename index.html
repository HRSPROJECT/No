<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noise Cancellation Demo</title>
    <style>
        
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px auto;
            max-width: 600px;
        }
        button {
            font-size: 16px;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }
        .status {
            margin-top: 20px;
            font-size: 18px;
            color: green;
        }
    </style>
</head>
<body>
    122333
    <h1>Real-Time Noise Cancellation</h1>
    <p>Click the button below to start or stop noise cancellation.</p>
    <button id="startButton">Start Noise Cancellation</button>
    <button id="stopButton" disabled>Stop Noise Cancellation</button>
    <div id="status" class="status">Status: Idle</div>

    <script>
        let audioContext;
        let micStream;
        let scriptProcessor;

        // Request microphone permission and start processing
        async function startNoiseCancellation() {
            try {
                document.getElementById("status").innerText = "Status: Requesting microphone access...";
                
                // Request microphone access
                micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Create audio context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(micStream);
                
                // Create a ScriptProcessorNode for processing audio data
                scriptProcessor = audioContext.createScriptProcessor(4096, 1, 1);

                source.connect(scriptProcessor);
                scriptProcessor.connect(audioContext.destination);

                scriptProcessor.onaudioprocess = (event) => {
                    // Access input audio data
                    const inputBuffer = event.inputBuffer.getChannelData(0);
                    const outputBuffer = event.outputBuffer.getChannelData(0);

                    // Simple noise cancellation: Zero out input audio (demo only)
                    for (let i = 0; i < inputBuffer.length; i++) {
                        outputBuffer[i] = inputBuffer[i] * 0.1; // Reduce volume (simulate suppression)
                    }
                };

                // Update UI
                document.getElementById("status").innerText = "Status: Noise Cancellation Active";
                document.getElementById("startButton").disabled = true;
                document.getElementById("stopButton").disabled = false;
            } catch (error) {
                console.error("Error accessing microphone:", error);
                document.getElementById("status").innerText = "Error: Unable to access microphone.";
            }
        }

        // Stop audio processing and release resources
        function stopNoiseCancellation() {
            if (scriptProcessor) {
                scriptProcessor.disconnect();
                scriptProcessor = null;
            }
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            if (micStream) {
                micStream.getTracks().forEach(track => track.stop());
                micStream = null;
            }

            // Update UI
            document.getElementById("status").innerText = "Status: Stopped";
            document.getElementById("startButton").disabled = false;
            document.getElementById("stopButton").disabled = true;
        }

        // Button event listeners
        document.getElementById("startButton").addEventListener("click", startNoiseCancellation);
        document.getElementById("stopButton").addEventListener("click", stopNoiseCancellation);
    </script>
</body>
</html>
